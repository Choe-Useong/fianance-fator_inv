# Finance Factor Investing

이 저장소는 전자공시(DART) 텍스트 파일을 파싱해 회계 항목을 정규화하고,
시가총액/거래대금 및 가격 데이터를 결합하여 팩터를 산출한 뒤,
백테스트까지 수행하는 일련의 파이프라인을 담고 있습니다.

## 개요

* **데이터 출처:** DART 텍스트(.txt) — [https://opendart.fss.or.kr/disclosureinfo/fnltt/dwld/main.do](https://opendart.fss.or.kr/disclosureinfo/fnltt/dwld/main.do)
* **정제 과정:** IFRS 태그 정규화, 연결/별도 구분, 비금융 업종 제외 등
* **조인 데이터:** pykrx (시가총액/거래대금), FinanceDataReader (월초 수정주가), yfinance (벤치마크)
* **팩터:** SIZE, BM, GP/A, TURNOVER, MOM(J,S) 등 (확장 가능)
* **운용 로직:** 7월 리밸런싱, 산업중립 z-score, 윈저라이즈, 교집합/스코어 방식, 동/가중평균, 벤치마크 비교

---

## 폴더 구조

* `코드/` 파이프라인 스크립트 모음

  * `1_txt_정리_병합.py` : 원천 DART .txt → Parquet 통합(`ALL.parquet`)
  * `2_연결구분.py` : 보고서종류 정규화, 연결/별도/주재무 구분
  * `3_사업보고서_필터.py` : 주재무 + 사업보고서 + KOSPI/KOSDAQ 필터링
  * `4_항목코드_정제.py` : `ifrs_`, `ifrs-full_` 접두 제거 → 계정코드 통일
  * `5_팩터추출.py` : 재무 항목(지배주주지분, 매출총이익 등) 추출 및 스켈레톤 구성
  * `6_팩터계산.py` : pykrx 시총/거래대금 결합 → 팩터 산출(`SIZE`, `BM`, `GP_A`, `TURNOVER`)
  * `7_수정주가수집.py` : FinanceDataReader 기반 월초 수정종가 수집(`월초_수정종가.parquet`)
  * `8_모멘텀지표추가.py` : MOM(J,S) 계산 및 팩터 테이블 병합
  * `9_백테스트.py` : 리밸런싱/유니버스/스코어링/성과평가 및 벤치마크 비교
  * `재무제표검색.py` : DART 기반 계정/항목 탐색용 유틸

---

## 실행 순서

1. **원본 정리** — `1_txt_정리_병합.py`
   cp949 텍스트(.txt) 다건을 Parquet으로 통합 저장.

2. **연결구분/주재무 설정** — `2_연결구분.py`
   연결/별도 판별, 기업×결산기준일 단위 주재무 식별.

3. **사업보고서 필터링** — `3_사업보고서_필터.py`
   주재무 + 사업보고서 + KOSPI/KOSDAQ 조건으로 필터링.

4. **IFRS 항목코드 정제** — `4_항목코드_정제.py`
   `ifrs_` 접두 제거 후 `항목코드_통일` 열 추가.

5. **팩터 항목 추출** — `5_팩터추출.py`
   지배주주지분, 자산총계, 매출총이익 등 핵심 항목 자동 매핑.

6. **팩터 계산** — `6_팩터계산.py`
   시가총액/거래대금 결합 후 팩터 생성:
   `SIZE = ln(시가총액)`, `BM = 지배주주지분 / 시가총액`, `GP_A = 매출총이익 / 자산총계`, `TURNOVER = 거래대금 / 시가총액`

7. **수정주가 수집** — `7_수정주가수집.py`
   월초 기준 FinanceDataReader 가격 수집 및 저장.

8. **모멘텀 지표 추가** — `8_모멘텀지표추가.py`
   MOM(J,S) 지표 계산(`12-1`, `12-6`, `6-1` 등) 및 팩터 병합.

9. **백테스트** — `9_백테스트.py`
   7월 리밸런싱 기준 유니버스 구성, 팩터 스코어 표준화, 포트폴리오 수익률 계산.

---

## 팩터 예시

| 팩터명      | 정의  | 식                 |
| :------- | :-- | :---------------- |
| SIZE     | 규모  | ln(시가총액)          |
| BM       | 가치  | 지배주주지분 / 시가총액     |
| GP_A     | 수익성 | 매출총이익 / 자산총계      |
| TURNOVER | 유동성 | 거래대금 / 시가총액       |
| MOM_J_S  | 모멘텀 | J개월 누적수익률, S개월 스킵 |

> 산업 중립화가 필요할 경우 `STD_METHOD = 'ind_z'` 로 설정.
* 지속적으로 추가 예정입니다.
---

## 요구 패키지

```
pip install pandas numpy pyarrow matplotlib pykrx FinanceDataReader yfinance
```

---

## 참고 사항

* 기본 분석 기간: 2016년 이후
* 금융 업종 제외, 12월 결산 기준
* DART 텍스트 파일은 `cp949`, Parquet 저장은 `utf-8`
* 외부 API 의존(pykrx, FDR)으로 시점별 데이터 차이 발생 가능

---

## 백테스트 결과 예시

![Portfolio vs Benchmark](docs/portfolio_vs_benchmark.png)
